<!DOCTYPE html>
<html>
<head>
	<link type="text/css" rel="stylesheet" href="/style.css"/>
	<title>WhiteBoard</title>

</head>
<body>
	<canvas id="myCanvas" width=1600px height = 800px 
	style="border: solid black 2px;    
	margin-left: auto;
    margin-right: auto;
    display: block;
    background-color:#F0F0F0;"
    
    >
</canvas>


<div id="buttonWrapper">
	<button type="button" id="black" onclick="colormeth.color(this)">Black</button>
	<button type="button" id="blue" onclick="colormeth.color(this)">Blue</button>
	<button type="button" id="red" onclick="colormeth.color(this)">Red</button>
	<button type="button" id="orange" onclick="colormeth.color(this)">Orange</button>
	<button type="button" id="white" onclick="colormeth.color(this)">White</button>
	<button type="button" id="yellow" onclick="colormeth.color(this)">Yellow</button>
	<button type="button" id="green" onclick="colormeth.color(this)">Green</button>
	<button type="button" id="eraser" onclick="colormeth.color(this)">Eraser</button>

</div>


<form id="frm1">
  X: <input type="int" name="xVar" id="xVar">
  Y: <input type="int" name="yVar" id="yVar">
	<button type="button" id="enter" onclick="globals.goto()">Enter</button>
</form>

<script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>
    
<script type="text/javascript" src="js/paper-full.js"></script>
    
    
	<script type="text/paperscript" canvas="myCanvas">

        //Initializing variables
        //networking variable
       // var socket = io();
        var path;
		var eraserSelected = false;
		//var xy = globals.getUrlVars();

		var strokeCol = 'black', strokeWid = 4, centerX = 0, centerY = 0;

		

		var textItem = new PointText({
			content: 'Click and Drag to Draw a Line. Use Arrow Keys to Scroll',
			point: new Point(500, 400),
			fillColor: 'black',
			fontSize: 20,
		});
		

		var textItem = new PointText({
			content: 'Click and Drag to Draw a Line. Use Arrow Keys to Scroll',
			point: new Point(500, 400),
			fillColor: 'black',
			fontSize: 20,
		});


		function onMouseDown(event) {
			// Create a new path and set its stroke color to x:
			path = new Path({
				segments: [event.point],
				strokeColor: strokeCol,
				strokeWidth: strokeWid,
			});
		}


		// While the user drags the mouse, points are added to the path
		// at the position of the mouse:
		function onMouseDrag(event) {
			path.add(event.point);
          //  emitPath(path);
		}


		// When the mouse is released, we simplify the path:
		function onMouseUp(event) {
			var segmentCount = path.segments.length;
			if(!eraserSelected){
				path.simplify(10);
			}
            notifyServer();
		}


		function onKeyDown(event) {
			if(event.key == 'up'){
				paper.view.scrollBy(new paper.Point(0,-100));
				return true;


			}			
			if(event.key == 'down'){
				paper.view.scrollBy(new paper.Point(0,100));
				        return true;

			}	
			if(event.key == 'right'){
				paper.view.scrollBy(new paper.Point(100,0));
				return true;


			}			
			if(event.key == 'left'){
				paper.view.scrollBy(new paper.Point(-100,0));
				        return true;

			}
		}

	


window.globals = {
 goto: function(){
 
		var xVar = parseInt(document.getElementById("xVar").value);
		var yVar = parseInt(document.getElementById("yVar").value);

		paper.view.center = new paper.Point(xVar*10 + 800, yVar*10 + 400);

		centerX = xVar;
		centerY = yVar;
	}
};

window.colormeth = {
	color: function(obj) {
		strokeCol = obj.id;
		if (strokeCol == 'eraser') {
			strokeCol = '#F0F0F0';
			strokeWid = 25;
			eraserSelected = true;
		}else{
			strokeWid = 4;
			eraserSelected = false;
		}
	}
};


//NETWORKING FUNCTIONS
  function initialize() {
            var http = new XMLHttpRequest();
            http.onreadystatechange = function(){
                if(http.responseText)
                    paper.project.importJSON(http.responseText);
            };
            http.open("GET", window.location.href + "initialize", true);
            http.setRequestHeader("Content-type", "application/json");
            http.send(paper.project.exportJSON());
           //TODO attach to subject 
        }
        initialize();
//functions to communicate with the server
    function notifyServer(){
        var http = new XMLHttpRequest();
        http.onreadystatechange = function(){
      //      paper.project.importJSON(http.responseText);
        }
        
        http.open("POST", window.location.href + "notifyServer", true);
    
        http.setRequestHeader("Content-type", "application/json");
        http.send(paper.project.exportJSON());
    }
//TODO emit path with socketio

</script>

</body>

</html>






